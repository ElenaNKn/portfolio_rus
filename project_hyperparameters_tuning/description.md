# CatBoost для решения задачи регрессии. Подбор гиперпараметров с Optuna

## Описание проекта

Проект является решением для соревнования https://www.kaggle.com/competitions/practical-ml-chocolate/overview в рамках курса ["Практический Machine Learning"](https://stepik.org/course/125501/info)

Решается задача определения рейтинга шоколада. Датасет содержит информацию о следующих характеристиках шоколадок:

Company - компания производитель
Specific Bean Origin - географический регион происхождения
REF - параметр, определяющий момент внесения записи в базу данных (чем выше значение, тем "свежее" запись)
Review - дата публикации отзыва
Cocoa Percent - процентное содержание какао
Company Location - страна производитель
Rating - экспертный рейтинг
Bean Type - используемый сорт какао-бобов, если таковой имеется
Broad Bean Origin - географический регион происхождения какао-бобов

Система рейтинга шоколада:

5 = Elite
4 = Premium
3 = Satisfactory(3.0) to praiseworthy(3.75)
2 = Disappointing
1 = Unpleasant

Метрика, по которой производится оценка модели в соревновании: ***r2_score***

## Этапы выполнения проекта

1. Предобработка данных, заполнение пропусков

2. Анализ датасета (EDA), оценка попарной корреляции числовых и взаимного влияния (на основании V-меры Крамера) текстовых признаков, анализ наличия выбросов и аномалий, оценка распределения целевой переменной.

3. Построение baseline модели CatBoostRegressor. Оценка по кросс-валидации качества модели при различном наборе категориальных признаков. Оценка влияния признаков на целевую переменную (feature importance)

4. Проектирование и отбор признаков. Определение оптимального набора признаков

5. Байесовский поиск гиперпараметров для модели с применением библиотеки Optuna 

## Результаты и выводы

1. Выполнена предобработка данных, которая включала преобразование признака `Cocoa Percent` в численный тип. Пропущенные значения признаков `Bean Type` и `Broad Bean Origin` заполнены значением "Unknown"

2. Проанализированы показатели распределений числовых признаков. Показано, что несмотря на наличие выбросов, они в целом находятся в допустимых диапазонах. Установлено наличие сильной корреляции между признаками `REF` и `Review`. Дальнейший анализ и моделирование показало, что признак `Review` (год написания отзыва) целесообразно рассматривать как категориальный, в то время как `REF` лучше оставить числовым. Это в целом позволяет решить проблему мультиколлениарности в части данных признаков.

3. Также на основании V-меры Крамера показана сильная взаимосвязь признаков `Company` и `Company Location`. Визуализация распределения объектов с маркировкой по этим признакам показала, что признак `Company` лучше разделяет данные (при этом количество принимаемых значений у признака гораздо больше, чем у `Company Location`).

4. На базе `CatBoostRegressor` с параметрами по умолчанию (заданы индексы категориальных признаков cat_features, зафиксирован random_seed, установлены logging_level='Silent' и eval_metric='R2') построена baseline модель. Метрика r2_score модели при рассчете по кросс-валидации на тестовом датасете составила 0,207. Анализ результатов моделирования показал, что все признаки достаточно важны, наибольшее влияние на целевую переменную оказывает признак `Company`

5. С помощью baseline модели выполнена серия экспериментов по исключению признаков и добавлению новых. Показано, что наилучший r2_score baseline модель принимает на первоначальном наборе данных.

6. Посредством `Optuna` выполнен подбор гиперпараметров для `CatBoostRegressor`. Построена модель со следующими значениями гиперпараметров:*{'learning_rate': 0.011350665681546111, 'max_depth': 8, 'n_estimators': 4060, 'min_child_samples': 196, 'subsample': 0.5719799748437518, 'use_best_model': True, 'logging_level': 'Silent', 'eval_metric': 'R2'}*.
Среднее значение r2_score модели на обучающих данных составило 0.2097. R2_score на тестовой выборке составил 0.21911

Ноутбук проекта доступен по ссылке: ["CatBoost для решения задачи регрессии. Подбор гиперпараметров с Optuna"](https://github.com/ElenaNKn/portfolio_rus/blob/master/project_hyperparameters_tuning/project.ipynb)